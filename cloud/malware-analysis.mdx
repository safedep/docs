---
title: Malware Analysis
description: "Detect malicious packages in your dependencies using SafeDep Cloud's advanced analysis"
---

# Malicious Package Scanning

<Info>
Malicious Package Scanning is a [SafeDep Cloud](/cloud/overview) service currently available as early preview with limited support.
</Info>

This feature allows you to analyze open source packages for malicious code using [vet](https://github.com/safedep/vet) integrated with SafeDep Cloud's hosted analysis service. The service supports scanning package artifacts from public package registries.

## Supported Ecosystems

<CardGroup cols={3}>
  <Card title="npm" icon="node-js">
    JavaScript and TypeScript packages
  </Card>
  <Card title="PyPI" icon="python">
    Python packages and wheels
  </Card>
  <Card title="Go Modules" icon="golang">
    Go language modules
  </Card>
  <Card title="RubyGems" icon="gem">
    Ruby packages and gems
  </Card>
  <Card title="GitHub Actions" icon="github">
    GitHub Action workflows
  </Card>
  <Card title="VS Code Extensions" icon="visual-studio-code">
    Visual Studio Code extensions
  </Card>
</CardGroup>

## Requirements

<Steps>
  <Step title="Install vet">
    You must have [vet](https://github.com/safedep/vet) version `1.9.7` or above installed
  </Step>
  
  <Step title="SafeDep Cloud Access">
    You must be onboarded to SafeDep Cloud with:
    - Tenant Domain
    - API Key
    
    See [SafeDep Cloud Quickstart](/cloud/quickstart) for onboarding instructions
  </Step>
</Steps>

## Repository Scanning

### Basic Malware Scanning

Enable malware analysis with the `--malware` flag:

```bash
vet scan -D /path/to/code --malware
```

<Note>
We make a trade-off between coverage and speed. `vet` waits for a timeout period for malware analysis to complete. This works well for pull requests and CI/CD pipelines where the number of changed packages is usually low.
</Note>

### Timeout Configuration

Adjust analysis timeout for different scenarios:

```bash
# Quick scan with shorter timeout
vet scan -D . --malware --malware-analysis-timeout 5m

# Thorough scan with longer timeout
vet scan -D . --malware --malware-analysis-timeout 15m
```

### Specific Manifest Scanning

Scan individual package manifest files:

```bash
# npm projects
vet scan -M package-lock.json --malware

# Python projects
vet scan -M requirements.txt --malware

# Go projects
vet scan -M go.mod --malware

# Ruby projects
vet scan -M Gemfile.lock --malware
```

### PURL-Based Scanning

Scan specific packages using Package URLs:

```bash
vet scan --purl pkg:/npm/llm-oracle@1.0.2 --malware
```

<img src="/images/vet-malysis-llm-oracle.png" alt="Malware analysis results for llm-oracle package" />

## Visual Studio Code Extensions

Scan locally installed VS Code extensions:

```bash
vet scan --vsx --malware
```

<Warning>
VS Code extension scanning is supported only for local developer machines, not in CI/CD environments.
</Warning>

## GitHub Actions Integration

### vet-action Cloud Mode

Enable malicious package protection in GitHub repositories using [vet-action](https://github.com/safedep/vet-action):

```yaml
name: Malware Protection
on:
  pull_request:
    branches: [ main ]

jobs:
  malware-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run malware analysis
        uses: safedep/vet-action@v1
        with:
          cloud: true
          malware: true
          cloud-key: ${{ secrets.SAFEDEP_CLOUD_API_KEY }}
          cloud-tenant: ${{ secrets.SAFEDEP_CLOUD_TENANT }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### Pull Request Integration

When enabled, vet scans changed packages for malware and provides results directly in pull requests:

<img src="/images/vet-action-malysis-1.png" alt="vet malware analysis in GitHub PR" />

Expand comments to view detailed package analysis results:

<img src="/images/vet-action-malysis-2.png" alt="Detailed malware analysis results in PR" />

## Package Inspection

### Enable Experimental Feature

Package inspection is currently experimental. Enable it with:

```bash
export VET_ENABLE_PACKAGE_INSPECT_COMMAND=true
```

### Inspect Single Packages

Perform detailed analysis of individual packages:

```bash
vet inspect malware --purl pkg:/npm/llm-oracle@1.0.2
```

<Note>
Package analysis is performed asynchronously. Scanning usually takes a few minutes but may take longer depending on the analysis queue.
</Note>

### Analysis Results

On completion, vet shows the analysis status and classification:

<img src="/images/llm-oracle-npm-malysis.png" alt="Malware scan result showing package classification" />

### Export Results

Export analysis results as JSON:

```bash
vet inspect malware \
  --purl pkg:/npm/llm-oracle@1.0.2 \
  --report-json /tmp/analysis.json
```

## Understanding Results

### Classification Levels

- **SAFE**: No malicious behavior detected
- **SUSPICIOUS**: Potentially risky patterns identified
- **MALICIOUS**: Confirmed malicious behavior found

### Analysis Techniques

<AccordionGroup>
  <Accordion title="Static Analysis">
    - Code pattern analysis
    - Suspicious function detection
    - Obfuscation identification
  </Accordion>
  
  <Accordion title="Behavioral Analysis">
    - Network communication patterns
    - File system access patterns
    - Process execution analysis
  </Accordion>
  
  <Accordion title="Metadata Analysis">
    - Package metadata anomalies
    - Publisher reputation analysis
    - Distribution pattern analysis
  </Accordion>
</AccordionGroup>

## CI/CD Integration Examples

### GitLab CI

```yaml
stages:
  - security

malware-scan:
  stage: security
  image: ghcr.io/safedep/vet:latest
  script:
    - vet scan -D . --malware --report-json malware-report.json
  artifacts:
    reports:
      security: malware-report.json
  variables:
    SAFEDEP_API_KEY: $SAFEDEP_API_KEY
    SAFEDEP_TENANT_ID: $SAFEDEP_TENANT_ID
```

### Jenkins Pipeline

```groovy
pipeline {
    agent any
    
    environment {
        SAFEDEP_API_KEY = credentials('safedep-api-key')
        SAFEDEP_TENANT_ID = credentials('safedep-tenant-id')
    }
    
    stages {
        stage('Malware Scan') {
            steps {
                sh 'vet scan -D . --malware --report-json malware-results.json'
                archiveArtifacts artifacts: 'malware-results.json'
                publishTestResults testResultsPattern: 'malware-results.json'
            }
        }
    }
}
```

## Best Practices

<AccordionGroup>
  <Accordion title="Performance Optimization">
    - Use shorter timeouts for CI/CD environments
    - Scan only changed packages in pull requests
    - Cache analysis results when possible
  </Accordion>
  
  <Accordion title="Security Integration">
    - Fail builds on malicious package detection
    - Set up alerts for suspicious packages
    - Regularly scan entire dependency trees
  </Accordion>
  
  <Accordion title="Team Workflow">
    - Train teams on interpreting results
    - Establish response procedures for malicious findings
    - Document approved exceptions for false positives
  </Accordion>
</AccordionGroup>

## Troubleshooting

<AccordionGroup>
  <Accordion title="Timeout Issues">
    If analysis times out frequently:
    - Increase timeout with `--malware-analysis-timeout`
    - Scan smaller package sets
    - Check network connectivity to SafeDep Cloud
  </Accordion>
  
  <Accordion title="Authentication Problems">
    If malware analysis fails with auth errors:
    - Verify API key has malware analysis permissions
    - Check tenant configuration
    - Ensure you're using vet v1.9.7 or later
  </Accordion>
  
  <Accordion title="False Positives">
    If legitimate packages are flagged:
    - Review the analysis details
    - Contact SafeDep support with package details
    - Use exceptions management for temporary overrides
  </Accordion>
</AccordionGroup>

<CardGroup cols={2}>
  <Card title="vet-action Documentation" icon="github" href="https://github.com/safedep/vet-action?tab=readme-ov-file#cloud-mode">
    Complete GitHub Actions integration guide
  </Card>
  <Card title="SafeDep Cloud Setup" icon="cloud" href="/cloud/quickstart">
    Get started with SafeDep Cloud for malware analysis
  </Card>
  <Card title="Package Inspection Guide" icon="magnifying-glass" href="https://github.com/safedep/vet#package-inspection">
    Learn more about experimental package inspection features
  </Card>
  <Card title="Report Issues" icon="bug" href="https://github.com/safedep/vet/issues">
    Report bugs or request features for malware analysis
  </Card>
</CardGroup>